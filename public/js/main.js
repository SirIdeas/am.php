// Generated by CoffeeScript 1.9.1
(function(){
  $(function(){
    (function(){

      $('.spyscroll[data-nav]').each(function(){
        
        var cls = $(this).data('class'),
            target = $($(this).data('nav')),
            relative = $($(this).data('relative')).offset().top,
            current = null;
        
        ret = $(this).find('a').map(function(){
          var selector = $(this).attr('href').replace(/.*(?=#[^\s]+$)/, '');
          return [[$(selector + ':visible').offset().top - $(selector).outerHeight() - relative, this]];
        }).sort(function(a, b){
          return a[0] - b[0];
        });

        $(this).bind('spyscroll', function(e, scrollTop){
          
          $(current).parents('li').removeClass(cls);
          current = null;

          for(var i = 0, len = ret.length; i < len; i++){
            var item = ret[i];
            if(item[0] >= scrollTop)
              break;
            current = item[1];
          }

          $(current).parents('li').addClass(cls);

        });

      });
    })();

    $('.spyscroll[data-equal]').bind('spyscroll', function(e, scrollTop){
      
      var cls = $(this).data('class'),
          cond = scrollTop === eval($(this).data('equal')),
          method = cond ? 'addClass' : 'removeClass';
      
      $(this)[method](cls);

    });

    $('.spyscroll[data-not-equal]').bind('spyscroll', function(e, scrollTop){
      
      var cls = $(this).data('class'),
          cond = scrollTop !== eval($(this).data('not-equal')),
          method = cond ? 'addClass' : 'removeClass';
      
      $(this)[method](cls);

    });

    $('.spyscroll[data-height]').bind('spyscroll', function(e, scrollTop){

      var cls = $(this).data('class'),
          target = $($(this).data('height')),
          cond = scrollTop >= target.outerHeight();

      if(target.length > 0){
        method = cond ? 'addClass' : 'removeClass';
        $(this)[method](cls);
      }

    });

    $('.spyscroll[data-custom]').bind('spyscroll', function(e, scrollTop){

      $(this).css('height', '');
      var height = $(this).height() - scrollTop;
      $(this).height(Math.max(height, 0));

    });

    $(document).scroll(function(){

      $('.spyscroll').trigger('spyscroll', $(this).scrollTop());

    });

    $(document).trigger('scroll');

  });

}).call(this);
